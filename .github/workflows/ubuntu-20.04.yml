name: build Linux

on: [push]

jobs:
  build:
    runs-on: ${{ matrix.os }}
    
    strategy:
      matrix:
        os: [ubuntu-20.04]

    steps:
      - name: Check-out repository
        uses: actions/checkout@v2

      - name: Download app and script
        run: |
          curl -O -L https://github.com/AndrewSazonov/ubuntu_screen_record/releases/download/v0.1/easyDiffraction_Linux_x86-64_v0.0.5_develop.zip
          unzip easyDiffraction_Linux_x86-64_v0.0.5_develop.zip
      
      - name: Set up screen recording dependencies
        run: |
          sudo apt-get install libxkbcommon-x11-0
          Xvfb :0 -screen 0 1440x1080x24 -ac &
          echo "DISPLAY=:0" >> $GITHUB_ENV

      - name: Install app
        run: easyDiffraction_Linux_x86-64_v0.0.5 --verbose --script SilentInstall.js

      - name: Run app
        run: /home/runner/easyDiffraction/easyDiffraction/easyDiffraction test

